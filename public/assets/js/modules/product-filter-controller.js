/*! ledvance-2019 1.3.1-95 17-11-2020 17:11:20 */
"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}define(["xhr","productFilterView","eventHelper"],function(a,b,c){var d=function a(d){_classCallCheck(this,a),this.el=d,this.classificationId=d.dataset.classificationId,this.languageId=d.dataset.languageId,this.facetFieldsUrl=d.dataset.facetFieldsUrl,this.facetOptionsUrl=d.dataset.facetOptionsUrl,this.psfName=d.dataset.psfName,this.eventHelper=new c,this.facetOptionTypes={dropdown:"_facet_string",slider:"_facet_double"},this.renderObjects=[],this.view=new b(this)};return d.prototype={constructor:d,buildFacetFieldsUrl:function(){return"".concat(this.facetFieldsUrl,"?classificationId=").concat(this.classificationId,"&languageId=").concat(this.languageId)},buildFacetOptionsQuery:function(){var a=this,b="",c={query:"*",classificationId:this.classificationId,languageId:this.languageId,ff:""};for(var d in this.facetFields.forEach(function(b){a.facetOptionTypes.hasOwnProperty(b.type)&&(c.ff+=(c.ff?",":"")+b.name+a.facetOptionTypes[b.type])}),c)b+=(b?"&":"?")+(d+"="+c[d]);return this.facetOptionsUrl+(this.facetOptionsUrl.endsWith("/")?"":"/")+"execute/"+this.psfName+b},getRequest:function(){var b=this;return new Promise(function(c){a.get(b.buildFacetFieldsUrl()).then(function(d){0==JSON.parse(d).facet_fields.length?b.view.emptyProductFilter():(b.facetFields=JSON.parse(d).facet_fields,a.get(b.buildFacetOptionsQuery()).then(function(a){b.facetOptions=JSON.parse(a),c()}))})})},init:function(){var a=this;this.getRequest().then(function(){a.prepareRender().then(function(){a.renderObjects.forEach(function(b,c,d){a.view.renderFilter(b,c),4>=d.length&&a.view.hideAccordionPanel()}),a.view.renderResultCount(a.facetOptions.response.numFound),a.view.addDropdownEvents(),a.view.addSliderEvents(),a.view.addCheckboxEvents(),a.view.addResetEvent(),a.setInitialProductsCount(),moduleLoader.parse(document.querySelector("#search .filter-group")),a.eventHelper.on("filter:update",function(){a.numResultUpdate()}),a.eventHelper.on("filter:reset",function(){a.resetProductsCount();var b=document.querySelector("#search button[type=\"reset\"]");b.setAttribute("disabled","disabled")})})})},numResultUpdate:function(){var b=this,c=this.facetOptionsUrl+(this.facetOptionsUrl.endsWith("/")?"":"/")+"execute/"+this.psfName,d=this.serializeArray(this.el),e="?query=*&";d.forEach(function(a){e+=a.name+"="+a.value+"&"}),e=e.substring(0,e.length-1),a.get(c+e).then(function(a){var c=JSON.parse(a);b.view.renderResultCount(c.response.numFound);var d=document.querySelector("#search button[type=\"reset\"]");d.removeAttribute("disabled")})},prepareRender:function(){var a=this;return new Promise(function(b){a.facetFields.forEach(function(b){var c,d={};"dropdown"==b.type&&(c=[],a.facetOptions.facet_counts.facet_fields["".concat(b.name).concat(a.facetOptionTypes[b.type])].forEach(function(a){"string"==typeof a&&c.push(a)}),null!==c&&2>c.length&&(c=null)),"slider"==b.type&&(c={},c=a.facetOptions.stats.stats_fields["".concat(b.name).concat(a.facetOptionTypes[b.type])],null!==c&&(c.min=Math.round(c.min),c.max=Math.round(c.max),c.rangeMin=Math.floor(0<c.min?.75*c.min:c.min),c.rangeMax=1.25*c.max,Math.ceil(c.rangeMax))),null!==c&&(_extends(d,b),_extends(d,{facetOptionType:"".concat(a.facetOptionTypes[b.type]),values:c}),a.renderObjects.push(d))}),b()})},serializeArray:function(a){var b,c,d=[];if("object"==_typeof(a)&&"FORM"==a.nodeName)for(var e=a.elements.length,f=0;f<e;f++)if(b=a.elements[f],b.name&&!b.disabled&&"file"!=b.type&&"reset"!=b.type&&"submit"!=b.type&&"button"!=b.type)if("select-multiple"==b.type)for(c=a.elements[f].options.length,j=0;j<c;j++)b.options[j].selected&&(d[d.length]={name:b.name,value:b.options[j].value});else("checkbox"!=b.type&&"radio"!=b.type||b.checked)&&(d[d.length]={name:b.name,value:b.value});return d},resetProductsCount:function(){this.view.renderResultCount(this.initialProductsCount)},setInitialProductsCount:function(){this.initialProductsCount=this.facetOptions.response.numFound}},{init:function(a){var b=new d(a);b.init()}}});